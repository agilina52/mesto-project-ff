(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-41",headers:{authorization:"0b29a7a6-71d4-445b-8202-2b632e1e043c","Content-Type":"application/json"}},t=function(t,o){return new Promise((function(n,r){fetch("".concat(e.baseUrl).concat(t),o).then((function(e){if(!e.ok)throw console.log("Запрос не обработан"),new Error("Error");return e.json()})).then((function(e){console.log(e),n(e)})).catch((function(e){console.log(e),r("Запрос отклонён")}))}))},o=document.querySelector("#card-template").content;function n(e,t,n,r,c){var a=o.cloneNode(!0),u=a.querySelector(".card__delete-button"),i=a.querySelector(".card__image"),l=a.querySelector(".card__title"),s=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-counter");return i.src=e.link,i.alt="Изображение места: ".concat(e.name),l.textContent=e.name,d.textContent=e.likes.length,c._id!==e.owner._id&&(u.hidden=!0),e.likes.some((function(e){return e._id===c._id}))&&(s.classList.add("card__like-button_is-active"),console.log(e.likes,c._id)),u.addEventListener("click",(function(){return t(u,e._id)})),s.addEventListener("click",(function(){return n(e._id,s,d)})),i.addEventListener("click",(function(){var e={src:i.src,alt:i.alt};r(e)})),a}function r(o,n,r){var c;n.classList.contains("card__like-button_is-active")?(n.classList.remove("card__like-button_is-active"),(c=o,t("/cards/likes/".concat(c),{method:"DELETE",headers:e.headers})).then((function(e){r.textContent=e.likes.length}))):(n.classList.add("card__like-button_is-active"),function(o){return t("/cards/likes/".concat(o),{method:"PUT",headers:e.headers})}(o).then((function(e){r.textContent=e.likes.length})))}function c(o,n){t("/cards/".concat(n),{method:"DELETE",headers:e.headers}),o.closest(".card").remove()}function a(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&u(t)}}function u(e){e.classList.add("popup_is-animated"),e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function l(e){e.target.classList.contains("popup_is-opened")&&u(e.target)}function s(e){e.target.classList.contains("popup__close")&&u(e.target.closest(".popup_is-opened"))}var d,p=function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));console.log(),t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},_=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))},f=function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(o){p(e,o,t)}))},m=null,v=document.querySelector(".places__list"),y=document.querySelectorAll(".popup"),S=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),b=h.querySelector(".popup__input_type_card-name"),g=h.querySelector(".popup__input_type_url"),E=q.querySelector(".popup__image"),C=q.querySelector(".popup__caption"),L=document.querySelector(".popup_type_edit-avatar"),k=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),A=document.querySelector(".avatar__edit-button"),w=h.querySelector(".popup__form"),T=S.querySelector(".popup__form"),B=L.querySelector(".popup__form"),D=T.querySelector(".popup__input_type_name"),P=T.querySelector(".popup__input_type_description"),N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function O(e){E.src=e.src,E.alt=e.alt,C.textContent=e.alt.replace("Изображение места: ",""),i(q)}function J(e){var t=document.querySelector(".profile__title"),o=document.querySelector(".profile__description"),n=document.querySelector(".profile__image");t.textContent=e.name,o.textContent=e.about,n.style.backgroundImage='url("'.concat(e.avatar,'")')}A.addEventListener("click",(function(){i(L),f(L,N)})),k.addEventListener("click",(function(){D.value=m.name,P.value=m.about,i(S),f(S,N)})),x.addEventListener("click",(function(){i(h);var e=Array.from(h.querySelector(N.formSelector)),t=h.querySelector(N.submitButtonSelector);_(e,t,N)})),w.addEventListener("submit",(function(o){o.preventDefault();var a,i=h.querySelector(".popup__button"),l=i.textContent;i.textContent="Сохранить...",(a={name:b.value,link:g.value},t("/cards",{method:"POST",headers:e.headers,body:JSON.stringify(a)})).then((function(e){var t=n(e,c,r,O,m);v.prepend(t),console.log(e)})).catch((function(e){console.log("Ошибка при создании карточки:",e)})).finally((function(){i.textContent=l,b.value="",g.value="",u(h)}))})),T.addEventListener("submit",(function(o){o.preventDefault();var n=S.querySelector(".popup__button"),r=n.textContent;n.textContent="Сохранить...";var c,a=D.value,i=P.value;u(S),(c={name:a,about:i},t("/users/me",{method:"PATCH",headers:e.headers,body:JSON.stringify(c)})).then((function(e){console.log(e),J(e)})).catch((function(e){console.log(e)})).finally((function(){n.textContent=r,u(h)}))})),B.addEventListener("submit",(function(o){o.preventDefault();var n,r=L.querySelector(".popup__input_type_url-avatar"),c=document.querySelector(".profile__image"),a=L.querySelector(".popup__button"),i=a.textContent;a.textContent="Сохранить...",(n=r.value,t("/users/me/avatar",{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})})).then((function(e){console.log(e),c.style.backgroundImage='url("'.concat(e.avatar,'")')})).catch((function(e){console.log(e)})).finally((function(){a.textContent=i,u(L)}))})),y.forEach((function(e){e.addEventListener("click",l),e.addEventListener("click",s)})),d=N,Array.from(document.querySelectorAll(d.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);_(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));console.log("!"),t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass),console.log("ошибка")}(e,t,t.validationMessage,o)})(e,r,t),_(o,n,t)}))}))}(e,d)}));var M=[t("/users/me",{method:"GET",headers:e.headers}),t("/cards",{headers:e.headers})];Promise.all(M).then((function(e){console.log(e),m=e[0],e[1].forEach((function(e){var t=n(e,c,r,O,m);v.append(t)})),J(e[0])})).catch((function(e){console.log(e)}))})();
//# sourceMappingURL=main.js.map