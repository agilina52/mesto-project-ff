(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,o,n,r,c){var i=e.cloneNode(!0),a=i.querySelector(".card__delete-button"),u=i.querySelector(".card__image"),l=i.querySelector(".card__title"),s=i.querySelector(".card__like-button"),p=i.querySelector(".card__like-counter");return u.src=t.link,u.alt="Изображение места: ".concat(t.name),l.textContent=t.name,p.textContent=t.likes.length,c._id!==t.owner._id&&(a.hidden=!0),t.likes.some((function(e){return e._id===c._id}))&&(s.classList.add("card__like-button_is-active"),console.log(t.likes,c._id)),a.addEventListener("click",(function(){return o(a,t._id)})),s.addEventListener("click",(function(){return n(t._id,s,p)})),u.addEventListener("click",(function(){var e={src:u.src,alt:u.alt};r(e)})),i}function o(e,t,o){var n;t.classList.contains("card__like-button_is-active")?(t.classList.remove("card__like-button_is-active"),(n=e,new Promise((function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-41/cards/likes/".concat(n),{method:"DELETE",headers:{authorization:"0b29a7a6-71d4-445b-8202-2b632e1e043c","Content-Type":"application/json"}}).then((function(e){if(!e.ok)throw new Error("ошибка удалении лайка");return e.json()})).then((function(t){console.log("Лайк удален",t),e(t)})).catch((function(e){console.log("ошибка лайка",e),t("Запрос отклонён")}))}))).then((function(e){o.textContent=e.likes.length}))):(t.classList.add("card__like-button_is-active"),function(e){return new Promise((function(t,o){fetch("https://nomoreparties.co/v1/wff-cohort-41/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"0b29a7a6-71d4-445b-8202-2b632e1e043c","Content-Type":"application/json"}}).then((function(e){if(!e.ok)throw new Error("ошибка при поставке лайка");return e.json()})).then((function(e){console.log("Лайк поставлен",e),t(e)})).catch((function(e){console.log("ошибка лайка",e),o("Запрос отклонён")}))}))}(e).then((function(e){o.textContent=e.likes.length})))}function n(e,t){var o;o=t,new Promise((function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-41/cards/".concat(o),{method:"DELETE",headers:{authorization:"0b29a7a6-71d4-445b-8202-2b632e1e043c","Content-Type":"application/json"}}).then((function(e){if(!e.ok)throw new Error("ошибка при удалении");return e.json()})).then((function(t){console.log("карточки удалены",t),e(t)})).catch((function(e){console.log("ошибка удаления карточек",e),t("Запрос отклонён")}))})),e.closest(".card").remove()}function r(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&c(t)}}function c(e){e.classList.add("popup_is-animated"),e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)}function a(e){e.target.classList.contains("popup_is-opened")&&c(e.target)}function u(e){e.target.classList.contains("popup__close")&&c(e.target.closest(".popup_is-opened"))}var l=function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));console.log(),t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},s=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))},p=function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(o){l(e,o,t)})),console.log("clearValidation")},d=null,f=document.querySelector(".places__list"),_=document.querySelectorAll(".popup"),h=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_image"),y=m.querySelector(".popup__input_type_card-name"),b=m.querySelector(".popup__input_type_url"),S=v.querySelector(".popup__image"),g=v.querySelector(".popup__caption"),q=document.querySelector(".popup_type_edit-avatar"),E=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__add-button"),k=document.querySelector(".avatar__edit-button"),w=m.querySelector(".popup__form"),L=h.querySelector(".popup__form"),x=L.querySelector(".popup__input_type_name"),j=L.querySelector(".popup__input_type_description"),P=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),A=q.querySelector(".popup__form"),z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function B(e){S.src=e.src,S.alt=e.alt,g.textContent=e.alt.replace("Изображение места: ",""),i(v)}var D,N,O=function(e){e.preventDefault();var t,o=x.value,n=j.value;c(h),(t={name:o,about:n},new Promise((function(e,o){fetch("https://nomoreparties.co/v1/wff-cohort-41/users/me",{method:"PATCH",headers:{authorization:"0b29a7a6-71d4-445b-8202-2b632e1e043c","Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){if(!e.ok)throw new Error("ошибка при обновлении профиля");return e.json()})).then((function(t){console.log("профиль обновлен",t),e(t)})).catch((function(e){console.log("ошибка обновления",e),o("Запрос отклонён")}))}))).then((function(e){console.log(e),J(e)})).catch((function(e){console.log(e)}))};function J(e){var t=document.querySelector(".profile__title"),o=document.querySelector(".profile__description"),n=document.querySelector(".profile__image");t.textContent=e.name,o.textContent=e.about,n.style.backgroundImage='url("'.concat(e.avatar,'")')}_.forEach((function(e){e.addEventListener("click",a)})),_.forEach((function(e){e.addEventListener("click",u)})),D=z,N=Array.from(document.querySelectorAll(D.formSelector)),console.log(),N.forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);console.log(),s(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?l(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));console.log("!"),t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass),console.log("ошибка")}(e,t,t.validationMessage,o)})(e,r,t),s(o,n,t)}))}))}(e,D)})),k.addEventListener("click",(function(){i(q),p(q,z)})),E.addEventListener("click",(function(){i(h),p(h,z)})),C.addEventListener("click",(function(){i(m);var e=Array.from(m.querySelector(z.formSelector)),t=m.querySelector(z.submitButtonSelector);s(e,t,z)})),w.addEventListener("submit",(function(e){e.preventDefault();var r=m.querySelector(".popup__button"),i=r.textContent;r.textContent="Сохранить...";var a,u={name:y.value,link:b.value};(a=u,new Promise((function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-41/cards",{method:"POST",headers:{authorization:"0b29a7a6-71d4-445b-8202-2b632e1e043c","Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(e){if(!e.ok)throw new Error("ошибка при добавлении карточек");return e.json()})).then((function(t){console.log("карточки добавлены",t),e(t)})).catch((function(e){console.log("ошибка добавления карточек",e),t("Запрос отклонён")}))}))).then((function(e){var r=t(e,n,o,B,d);f.prepend(r),console.log(e)})).catch((function(e){console.log("Ошибка при создании карточки:",e)})).finally((function(){r.textContent=i,y.value="",b.value="",c(m)}))})),h.querySelector(".popup__form").addEventListener("submit",O),L.addEventListener("submit",O),document.querySelector(".profile__edit-button").addEventListener("click",(function(){x.value=P.textContent,j.value=T.textContent})),A.addEventListener("submit",(function(e){e.preventDefault();var t=q.querySelector(".popup__input_type_url-avatar"),o=document.querySelector(".profile__image"),n=q.querySelector(".popup__button"),r=n.textContent;n.textContent="Сохранить...";var i,a=t.value;(i=a,new Promise((function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-41/users/me/avatar",{method:"PATCH",headers:{authorization:"0b29a7a6-71d4-445b-8202-2b632e1e043c","Content-Type":"application/json"},body:JSON.stringify({avatar:i})}).then((function(e){if(!e.ok)throw new Error("ошибка обновления аватара");return e.json()})).then((function(t){console.log("аватар обновлён",t),e(t)})).catch((function(e){console.log("ошибка обновления аватара",e),t("Запрос отклонён")}))}))).then((function(e){console.log(e),o.style.backgroundImage='url("'.concat(e.avatar,'")')})).catch((function(e){console.log(e)})).finally((function(){n.textContent=r,c(q)}))}));var M=[new Promise((function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-41/users/me",{method:"GET",headers:{authorization:"0b29a7a6-71d4-445b-8202-2b632e1e043c"}}).then((function(e){if(!e.ok)throw console.log("Запрос Users не обработан"),new Error("Error Users!");return e.json()})).then((function(t){console.log(t),e(t)})).catch((function(e){console.log(e),t("Запрос отклонён")}))})),new Promise((function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-41/cards",{headers:{authorization:"0b29a7a6-71d4-445b-8202-2b632e1e043c"}}).then((function(e){if(!e.ok)throw console.log("Запрос Cards не обработан"),new Error("Error Cards!");return e.json()})).then((function(t){console.log(t),e(t)})).catch((function(e){console.log(e),t("Запрос отклонён")}))}))];Promise.all(M).then((function(e){console.log(e),d=e[0],e[1].forEach((function(e){var r=t(e,n,o,B,d);f.append(r)})),J(e[0])})).catch((function(e){console.log(e)}))})();
//# sourceMappingURL=main.js.map